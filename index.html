<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="UTF-8">
    <title>Employee Data Management</title>

    <!-- jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Bootstrap CDN-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <!-- Firebase References -->
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>

    <!-- Moment.js Reference -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>

</head>

<body>

    <div class="container">

        <br>

        <!-- Jumbotron Title -->
        <div class="jumbotron bg-dark text-white">
            <h1 class="text-center">Anytime is Train time</h1>
            <h3 class="text-center">Choo Choo Chee Chee</h3>
        </div>

        <!-- Current Product -->
        <div class="row">
            <div class="col-lg-12">
                <div class="card-header">
                    Current Train Schedule
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th scope="col">Train Name</th>
                            <th scope="col">Destination</th>
                            <th scope="col">Frequency(min)</th>
                            <th scope="col">Next Arrival</th>
                            <th scope="col">Minutes Away</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>

        <!-- use bootstrap to layout the first form -->
        <div class="row">
            <div class="col-lg-12">
                <div class="card card-default">
                    <div class="card-header">
                        Add Train
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="form-group row m-1">
                                <label for="bidder-name"> Train Name</label>
                                <input class="form-control" placeholder="Green Skin" id="Name" type="text">
                            </div>
                            <div class="form-group row m-1">
                                <label for="bidder-price"> Destination</label>
                                <input class="form-control" placeholder="Seattle" id="Place" type="text">
                            </div>
                            <div class="form-group row m-1">
                                <label for="bidder-price"> First Train Time (HH:mm military time)</label>
                                <input class="form-control" placeholder="03:04 AM" id="Start" type="number">
                            </div>
                            <div class="form-group row m-1">
                                <label for="bidder-price"> Frequency (min)</label>
                                <input class="form-control" placeholder="25" id="Frequency" type="number">
                            </div>
                            <button class="btn btn-primary float-right m-2" id="Submit" type="submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Script -->
    <script>

        var firebaseConfig = {
            apiKey: "AIzaSyDHBJs_zGy415JgQiH2m-NIYLM-_hTp7XI",
            authDomain: "push-84fba.firebaseapp.com",
            databaseURL: "https://push-84fba.firebaseio.com",
            projectId: "push-84fba",
            storageBucket: "",
            messagingSenderId: "825266547825",
            appId: "1:825266547825:web:9adc81d5d636f11b29bfd0"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        var database = firebase.database();

        $('#Submit').on("click", function (event) {
            event.preventDefault();

            // Grabbed values from text boxes
            Name = $("#Name").val().trim();
            Place = $("#Place").val().trim();
            Start = moment($("#Start").val().trim(), ("HH:mm military time").format("x"));
            Monthly = $("#Frequency").val().trim();

            // Code for handling the push
            database.ref().push({
                Name: Name,
                Place: Place,
                Start: Start,
                Frequency: Frequency,
                dateAdded: firebase.database.ServerValue.TIMESTAMP
            });

            alert("Employee successfully added");
            Name = $("#Name").val("");
            Place = $("#Place").val("");
            Start = $("#Start").val("");
            Frequency = $("#Frequency").val("");

        });

        // Firebase watcher .on("child_added"
        database.ref().on("child_added", function (snapshot) {
            // storing the snapshot.val() in a variable for convenience
            var sv = snapshot.val();
            // Prettify the Train start
            var start = moment.unix(sv.Start).format("HH:mm military time");
            // Calculate the months worked using hardcore math
            // To calculate the months worked
            var months = moment().diff(moment(sv.Start, "X"), "Start");
            // Change the HTML to reflect
            $tr = $('<tr>');
            $Name = $('<td>').text(sv.Name);
            $Place = $('<td>').text(sv.place);
            $Start = $('<td>').text(start);
            $Frequency = $('<td>').text(frequency);

            $tr.append($Name, $Place, $Start, $Frequency);
            $('.table').append($tr);

            // Handle the errors
        }, function (errorObject) {
            console.log("Errors handled: " + errorObject.code);
        });

    </script>

</body>

</html>